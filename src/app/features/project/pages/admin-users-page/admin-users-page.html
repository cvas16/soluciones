<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Panel de Administraci√≥n</h2>
    <button class="btn btn-outline-primary btn-sm" (click)="loadUsers()">
      <i class="bi bi-arrow-clockwise"></i> Refrescar
    </button>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">

      <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary" role="status"></div>
      </div>

      <div class="table-responsive" *ngIf="!isLoading">
        <table class="table table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Usuario</th>
              <th>Email</th>
              <th>Proyectos</th>
              <th>Roles</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" [class.table-danger]="user.locked">
              <td>{{ user.id }}</td>
              <td>
                <div class="fw-bold">{{ user.username }}</div>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <span class="badge bg-light text-dark border">{{ user.projectCount }}</span>
              </td>
              <td>
                <span *ngFor="let role of user.roles"
                      class="badge me-1"
                      [ngClass]="role === 'ROLE_ADMIN' ? 'bg-danger' : 'bg-secondary'">
                  {{ role.replace('ROLE_', '') }}
                </span>
              </td>
              <td>
                <span class="badge" [ngClass]="user.locked ? 'bg-danger' : 'bg-success'">
                  {{ user.locked ? 'BLOQUEADO' : 'ACTIVO' }}
                </span>
              </td>
              <td class="text-end">
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-secondary"
                          (click)="toggleAdmin(user)"
                          title="Cambiar permisos de Admin"
                          [disabled]="user.id === currentUserId">
                    <i class="bi" [ngClass]="hasRole(user, 'ROLE_ADMIN') ? 'bi-shield-minus' : 'bi-shield-plus'"></i>
                  </button>

                  <button class="btn btn-sm"
                          [ngClass]="user.locked ? 'btn-outline-success' : 'btn-outline-danger'"
                          (click)="toggleLock(user)"
                          title="{{ user.locked ? 'Desbloquear' : 'Bloquear' }}"
                          [disabled]="user.id === currentUserId">
                    <i class="bi" [ngClass]="user.locked ? 'bi-unlock-fill' : 'bi-lock-fill'"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

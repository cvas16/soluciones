<div
  class="project-container"
  *ngIf="project && !isLoading && !errorMessage"
  [class.has-background]="project.background"
>
  <div class="project-header">
    <div class="header-left">
      <div class="breadcrumbs">Proyectos <span>/</span> {{ project.name }}</div>
      <h1 class="project-title">{{ project.name }}</h1>
      <p class="project-desc" *ngIf="project.description">{{ project.description }}</p>
    </div>

    <div class="header-right d-flex align-items-center gap-3">
      <div class="member-stack" *ngIf="project.members && project.members.length > 0">
        <div *ngFor="let member of project.members" class="member-avatar" [title]="member.username">
          {{ member.username.charAt(0).toUpperCase()}}
        </div>
      </div>
      <button class="btn btn-light btn-sm d-flex align-items-center gap-2" (click)="inviteUser()">
        <i class="bi bi-person-plus-fill"></i>
        <span>Invitar</span>
      </button>
    </div>
  </div>

  <div class="board-wrapper">
    <div class="board-container" cdkDropListGroup>
      <app-board-column
        *ngFor="let column of boardColumns"
        [columnTitle]="column"
        [tasks]="columns[column]"
        [projectId]="project.id"
        (taskDropped)="onTaskDrop($event)"
        (taskClicked)="openTaskDetail($event)"
        (taskMoved)="onQuickStatusChange($event)"
      >
      </app-board-column>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="text-center mt-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Cargando proyecto...</span>
  </div>
</div>

<div *ngIf="errorMessage" class="alert alert-danger m-4">
  {{ errorMessage }}
</div>

<app-task-detail-modal
  [isVisible]="isTaskModalVisible"
  [task]="selectedTask"
  (closed)="onTaskModalClose()"
  (taskUpdated)="onTaskUpdated($event)"
  (taskDeleted)="onTaskDeleted($event)"
  [projectMembers]="project?.members || []"
  [canAssign]="isOwner"
>
</app-task-detail-modal>
<app-invite-member-modal
  [isVisible]="showInviteModal"
  [projectId]="project?.id || 0"
  (closed)="showInviteModal = false"
  (memberInvited)="onMemberInvited()"
>
</app-invite-member-modal>
